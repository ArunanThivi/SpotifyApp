<html>
    <head>        
      <link rel="stylesheet" href="css/master.css">
    </head>
    <body>
        <div id="songForm">
            Text
            <form id="songs" action="" method="POST">            
                <input type="text" name="song1" class='inputBox'>
                <button type="button" form = 'songs' onClick='addLine()' id='newLine'>New Song</button><br>
            </form>        
            <button type="button" form = 'songs' onClick='getSongs()' id='submit'>Submit</button>
        </div>        
        <script src="js/app.js"></script>
        <script>
            var access_token = getHashParams().access_token;
            var ids = '';
            var songs = {}
            var counter = 2;
            function addLine() {
                if (counter < 6) {
                    var line = `<input type="text" name="song${counter}" class="inputBox">`;
                    const button = "<button type='button' form = 'songs' onClick='addLine()' id='newLine'>New Song</button><br>";
                    document.getElementById('newLine').remove();
                    document.getElementById('songs').insertAdjacentHTML('beforeend', line);
                    document.getElementById('songs').insertAdjacentHTML('beforeend', button);
                }
                if (counter == 6) {
                    alert("Song Limit Reached");
                }                               
                counter++;
            }

            async function getSongs() {
                var output = '';
                var form = new FormData(document.querySelector("form"));
                for (var song of form.values()) {
                    var obj = await APIController.searchTrack(access_token, song);
                    obj = obj.tracks.items[0];
                    songs[song] = obj;
                    var album = obj.album.name;
                    var cover = obj.album.images[2].url;
                    var artist = obj.artists[0].name;
                    var id = obj.id;
                    ids += id+',';
                    var features = await APIController.multiFeatures(access_token, ids);
                    output += `<img src=${cover}><br>Artist: ${artist}<br> Album: ${album}<br>`;
                }
                console.log(songs);                
                console.log(features);
                displayText(output);
            }

            function displayText(output) {
                document.write(output);
            }

        </script>
    </body>
</html>
